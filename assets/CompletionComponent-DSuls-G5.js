import{r as d,u as $,a as U,b as q,d as z,j as e,e as E,X as K}from"./index-Tghuj-1g.js";import{u as Q}from"./useToast-D7WQYd5T.js";import{u as V}from"./useLearningCleanup-qXJUIooo.js";import{s as W}from"./randomUtils-DP179wgg.js";import{C as I}from"./check-D6lIamT3.js";import{A as X}from"./arrow-right-7VedVTkx.js";const Z=({module:n})=>{var v,S,A;const[c,_]=d.useState(0),[r,u]=d.useState(""),[a,p]=d.useState(!1),[b]=d.useState(Date.now()),{updateSessionScore:f,setCurrentView:m}=$(),{updateUserScore:w}=U(),{language:T}=q(),{addProgressEntry:y}=z(),{t:j}=E(T),{showCorrectAnswer:k,showIncorrectAnswer:N,showModuleCompleted:C}=Q();V();const l=d.useMemo(()=>n!=null&&n.data?W(n.data):[],[n==null?void 0:n.data]),t=l[c];d.useEffect(()=>{if(!a&&l.length>0){const o=document.querySelector('input[type="text"]');o&&setTimeout(()=>o.focus(),100)}},[c,a,l.length]);const g=d.useCallback(()=>{var x;if(a)return;const o=r.toLowerCase().trim(),s=((x=t==null?void 0:t.correct)==null?void 0:x.toLowerCase().trim())||"",i=o===s;f(i?{correct:1}:{incorrect:1}),p(!0),i?k():N()},[a,r,t==null?void 0:t.correct,f,k,N]),h=d.useCallback(()=>{if(c<l.length-1)_(c+1),u(""),p(!1);else{const o=Math.floor((Date.now()-b)/1e3),{sessionScore:s}=$.getState(),i=Math.round(s.correct/s.total*100);y({score:i,totalQuestions:s.total,correctAnswers:s.correct,moduleId:n.id,learningMode:"completion",timeSpent:o});const x=s.accuracy;C(n.name,i,x),w(n.id,i,o),m("menu")}},[c,l.length,b,y,n.id,n.name,C,w,m]);if(d.useEffect(()=>{if(l.length===0)return;const o=s=>{s.key==="Enter"&&!a?r.trim()&&g():s.key==="Enter"&&a?h():s.key==="Escape"&&m("menu")};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[r,a,l.length,g,h,m]),!l.length)return e.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6 text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:j("noDataAvailable")||"No completion exercises available"}),e.jsx("button",{onClick:()=>m("menu"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:j("navigation.mainMenu")})]});const P=()=>{if(!(t!=null&&t.sentence))return null;const o=t.sentence.split("______"),s=[];return o.forEach((i,x)=>{var L;if(i&&s.push(e.jsx("span",{className:"text-gray-900 dark:text-white",children:i},`text-${x}`)),x<o.length-1){const M=a&&r.toLowerCase().trim()===((L=t.correct)==null?void 0:L.toLowerCase().trim()),D=a&&r&&!M;s.push(e.jsx("input",{type:"text",value:r,onChange:F=>u(F.target.value),disabled:a,placeholder:"...",autoComplete:"off",className:`inline-block mx-2 px-3 py-1.5 min-w-[120px] text-center rounded-lg border-2 focus:outline-none transition-all duration-200 font-medium ${a?M?"border-green-500 bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-200":D?"border-red-500 bg-red-50 text-red-700 dark:bg-red-900 dark:text-red-200":"border-gray-300 bg-gray-50 text-gray-600 dark:bg-gray-700 dark:text-gray-300":"border-blue-300 bg-blue-50 focus:border-blue-500 focus:bg-white text-gray-900 dark:bg-gray-700 dark:border-gray-500 dark:text-white dark:focus:bg-gray-600"}`,style:{width:`${Math.max(120,((r==null?void 0:r.length)||3)*12+60)}px`}},`input-${x}`))}}),e.jsx(e.Fragment,{children:s})},R=r.trim().length>0;return e.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:n.name}),e.jsx("span",{className:"text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1 rounded-full",style:{minWidth:"60px",textAlign:"center"},children:l.length>0?`${c+1}/${l.length}`:"..."})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-purple-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${(c+1)/l.length*100}%`}})}),e.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:a?"Press Enter for next exercise":"Fill the blank and press Enter"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Complete the sentence:"}),(t==null?void 0:t.tip)&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900 border-l-4 border-blue-400 rounded-r-lg",children:e.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["üí° ",e.jsx("strong",{children:"Tip:"})," ",t.tip]})}),e.jsx("div",{className:"text-lg leading-relaxed mb-4 p-6 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800 rounded-xl border border-gray-200 dark:border-gray-600 shadow-inner",children:e.jsx("div",{className:"text-gray-900 dark:text-white font-medium",children:P()})}),e.jsx("div",{className:`mt-3 overflow-hidden transition-all duration-300 ease-in-out ${a?"max-h-32 opacity-100":"max-h-0 opacity-0"}`,children:e.jsxs("div",{className:"px-3 py-2 bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-1.5 flex-wrap",children:[r.toLowerCase().trim()===((v=t==null?void 0:t.correct)==null?void 0:v.toLowerCase().trim())?e.jsx(I,{className:"h-3.5 w-3.5 text-green-600"}):e.jsx(K,{className:"h-3.5 w-3.5 text-red-600"}),e.jsx("span",{className:"font-medium text-xs text-gray-900 dark:text-white",children:r.toLowerCase().trim()===((S=t==null?void 0:t.correct)==null?void 0:S.toLowerCase().trim())?"Correct!":"Incorrect"}),r.toLowerCase().trim()!==((A=t==null?void 0:t.correct)==null?void 0:A.toLowerCase().trim())&&e.jsxs("span",{className:"text-xs text-gray-700 dark:text-gray-300",children:["- Answer: ",e.jsx("strong",{children:t==null?void 0:t.correct})]})]}),(t==null?void 0:t.explanation)&&e.jsx("div",{className:"border-t border-blue-200 dark:border-blue-700 pt-2 mt-2",children:e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-300 leading-relaxed",children:[e.jsx("span",{className:"font-medium",children:"Explanation:"})," ",t.explanation]})})]})})]}),e.jsxs("div",{className:"flex justify-center items-center gap-3 flex-wrap mt-6",children:[e.jsx("button",{onClick:()=>m("menu"),className:"flex items-center gap-1 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors text-sm font-medium",children:"‚Üê Menu"}),e.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),a?e.jsxs("button",{onClick:h,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:[e.jsx("span",{children:c===l.length-1?"Finish Exercise":"Next Exercise"}),e.jsx(X,{className:"h-4 w-4"})]}):e.jsxs("button",{onClick:g,disabled:!R,className:"flex items-center gap-2 px-6 py-2.5 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:[e.jsx(I,{className:"h-4 w-4"}),e.jsx("span",{children:"Check Answer"})]})]})]})};export{Z as default};
