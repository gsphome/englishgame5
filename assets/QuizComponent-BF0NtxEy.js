import{r as g,u as C,a as E,b as L,d as T,j as s,C as M,f as $}from"./index-BKxTNVQ3.js";import{u as q}from"./useToast-B8ivF6A5.js";import{u as I,N as R}from"./NavigationButton-4kyoXkt1.js";import{s as A}from"./randomUtils-DP179wgg.js";import{A as _}from"./arrow-right-7CGQZ_vj.js";const D=["span","strong","em","b","i"],B=["class"],P=n=>{if(typeof n!="string")return"";let a=n.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return a=a.replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi,""),a=a.replace(/javascript:/gi,""),a=a.replace(/data:(?!image\/(?:png|jpg|jpeg|gif|svg\+xml))[^;]*/gi,""),["script","object","embed","link","style","meta","iframe","form","input"].forEach(m=>{const x=new RegExp(`<\\/?${m}\\b[^>]*>`,"gi");a=a.replace(x,"")}),a=a.replace(/<(\w+)([^>]*)>/gi,(m,x,l)=>{if(!D.includes(x.toLowerCase()))return"";const p=l.replace(/(\w+)\s*=\s*["']([^"']*)["']/gi,(f,o,h)=>{if(!B.includes(o.toLowerCase()))return"";if(o.toLowerCase()==="class"){const d=h.replace(/[^a-zA-Z0-9\s\-_]/g,"");return`${o}="${d}"`}return`${o}="${h}"`});return`<${x}${p}>`}),a},H=n=>({__html:P(n)}),V=({module:n})=>{const[a,y]=g.useState(0),[m,x]=g.useState(null),[l,p]=g.useState(!1),[f]=g.useState(Date.now()),o=g.useMemo(()=>{if(!(n!=null&&n.data))return[];const i=n.data;return A(i).map(r=>{if(!r.options||!r.correct)return r;const c=A([...r.options]);return{...r,options:c}})},[n==null?void 0:n.data]),{updateSessionScore:h,setCurrentView:d}=C(),{updateUserScore:j}=E(),{theme:z}=L(),{addProgressEntry:k}=T(),{showCorrectAnswer:v,showIncorrectAnswer:N,showModuleCompleted:S}=q();I();const b=z==="dark"?"white":"#111827",e=o[a],u=g.useCallback(i=>{var c;if(l||!e)return;const r=((c=e.options)==null?void 0:c[i])===e.correct;x(i),p(!0),h(r?{correct:1}:{incorrect:1}),r?v():N()},[l,e,h,v,N]),w=g.useCallback(()=>{if(a<o.length-1)y(a+1),x(null),p(!1);else{const i=Math.floor((Date.now()-f)/1e3),{sessionScore:t}=C.getState(),r=Math.round(t.correct/t.total*100),c=t.accuracy;k({score:r,totalQuestions:t.total,correctAnswers:t.correct,moduleId:n.id,learningMode:"quiz",timeSpent:i}),S(n.name,r,c),j(n.id,r,i),d("menu")}},[a,o.length,f,k,n.id,n.name,S,j,d]);return g.useEffect(()=>{if(o.length===0)return;const i=t=>{var r;if(t.key>="1"&&t.key<="4"&&!l&&e){const c=parseInt(t.key)-1;c<(((r=e.options)==null?void 0:r.length)||0)&&u(c)}else t.key==="Enter"&&l?w():t.key==="Escape"&&d("menu")};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[l,e,o.length,u,w,d]),o.length?s.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:n.name}),s.jsx("span",{className:"text-sm font-medium text-gray-600 bg-gray-100 px-3 py-1 rounded-full",style:{minWidth:"60px",textAlign:"center"},children:o.length>0?`${a+1}/${o.length}`:"..."})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:s.jsx("div",{className:"bg-green-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${(a+1)/o.length*100}%`}})}),s.jsx("p",{className:"text-xs text-gray-500 mt-2 text-center",children:l?"Press Enter for next question":"Press 1-4 to select or click an option"})]}),s.jsxs("div",{className:"quiz-question bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-6 mb-4",children:[s.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-4 sm:mb-6",style:{color:b},children:s.jsx("div",{dangerouslySetInnerHTML:H((e==null?void 0:e.sentence)||"Loading question...")})}),s.jsx("div",{className:"grid grid-cols-2 gap-4",children:((e==null?void 0:e.options)||[]).map((i,t)=>{let r="quiz-option w-full p-3 text-left border-2 rounded-lg transition-all duration-200 ";return l?(e==null?void 0:e.options[t])===(e==null?void 0:e.correct)?r+="quiz-option--correct border-green-500 dark:border-green-400 bg-green-50 dark:bg-green-900 text-green-800 dark:!text-white":t===m&&(e==null?void 0:e.options[t])!==(e==null?void 0:e.correct)?r+="quiz-option--incorrect border-red-500 dark:border-red-400 bg-red-50 dark:bg-red-900 text-red-800 dark:!text-white":r+="quiz-option--disabled border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-600 dark:!text-white":r+="border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-gray-700 text-gray-900 dark:!text-white",s.jsx("button",{onClick:()=>u(t),disabled:l,className:r,children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"w-6 h-6 bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-full flex items-center justify-center text-xs font-medium mr-3",children:t+1}),s.jsx("span",{className:"text-sm",style:{color:b},children:i})]}),l&&s.jsxs("div",{children:[(e==null?void 0:e.options[t])===(e==null?void 0:e.correct)&&s.jsx(M,{className:"h-6 w-6 text-green-600"}),t===m&&(e==null?void 0:e.options[t])!==(e==null?void 0:e.correct)&&s.jsx($,{className:"h-6 w-6 text-red-600"})]})]})},t)})}),s.jsx("div",{className:`mt-6 overflow-hidden transition-all duration-300 ease-in-out ${l&&(e!=null&&e.explanation)?"max-h-40 opacity-100":"max-h-0 opacity-0"}`,children:s.jsxs("div",{className:"quiz-explanation p-4 bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg",children:[s.jsx("h4",{className:"font-medium mb-2",style:{color:b},children:"Explanation:"}),s.jsx("p",{style:{color:b},children:(e==null?void 0:e.explanation)||""})]})})]}),s.jsxs("div",{className:"flex justify-center items-center gap-3 flex-wrap mt-6",children:[s.jsx(R,{onClick:()=>d("menu"),title:"Return to main menu",children:"Back to Menu"}),s.jsx("div",{className:"w-px h-6 bg-gray-300 dark:bg-gray-600 mx-1"}),s.jsxs("button",{onClick:w,disabled:!l,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:[s.jsx("span",{children:a===o.length-1?"Finish Quiz":"Next Question"}),s.jsx(_,{className:"h-4 w-4"})]})]})]}):s.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6 text-center",children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"No quiz questions available"}),s.jsx("button",{onClick:()=>d("menu"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Menu"})]})};export{V as default};
