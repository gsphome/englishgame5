import{r as d,u as A,a as H,d as J,b as X,j as s}from"./index-mZh2z630.js";import{u as Y}from"./useToast-C33hfAzv.js";import{u as ee,N as se}from"./NavigationButton-B6-yk8Bp.js";import{R as te}from"./rotate-ccw-CRuEzHr4.js";import{C as re}from"./check-CLrfYTjJ.js";const ne=(n,l)=>{if(l!=null&&l.categories&&Array.isArray(l.categories)){const h=l.categories.find(f=>f.category_id===n);if(h!=null&&h.category_show)return h.category_show}return n.charAt(0).toUpperCase()+n.slice(1).replace(/_/g," ")},de=({module:n})=>{const[l,h]=d.useState(null),[f,w]=d.useState({}),[p,b]=d.useState([]),[g,N]=d.useState(!1),[D]=d.useState(Date.now()),[M,y]=d.useState(null),{updateSessionScore:R,setCurrentView:v}=A(),{updateUserScore:$}=H(),{addProgressEntry:z}=J(),{showCorrectAnswer:I,showIncorrectAnswer:W,showModuleCompleted:_}=Y();ee();const[c,L]=d.useState({id:"",words:[],categories:[]});d.useEffect(()=>{const e=t=>{t.key==="Escape"&&v("menu")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[v]),d.useEffect(()=>{var t;let e={id:"",words:[],categories:[]};if(n!=null&&n.data&&Array.isArray(n.data)){const r=n.data[0];if(r&&"category"in r&&"word"in r){const m=[...new Set(n.data.map(x=>x.category))].sort(()=>Math.random()-.5),{gameSettings:i}=X.getState(),o=i.sortingMode.wordCount,u=i.sortingMode.categoryCount||3,Q=m.slice(0,u),V=Math.ceil(o/u),k=[],Z=Q.map(x=>{const j=(n.data||[]).filter(C=>C.category===x).map(C=>C.word).slice(0,V);return k.push(...j),{name:ne(x,n),items:j}}),E=k.slice(0,o),G=Z.map(x=>({...x,items:x.items.filter(j=>E.includes(j))}));e={id:"sorting-exercise",words:E,categories:G}}}if(L(e),((t=e.words)==null?void 0:t.length)>0){const r=[...e.words].sort(()=>Math.random()-.5);b(r);const a={};(e.categories||[]).forEach(m=>{a[m.name]=[]}),w(a)}},[n.id,n.data]);const O=(e,t)=>{h(t),e.dataTransfer.effectAllowed="move"},F=(e,t)=>{e.preventDefault(),e.dataTransfer.dropEffect="move",y(t)},P=e=>{e.preventDefault(),y(null)},T=(e,t)=>{e.preventDefault(),l&&(b(r=>r.filter(a=>a!==l)),w(r=>({...r,[t]:[...r[t]||[],l]})),h(null),y(null))},U=(e,t)=>{g||(w(r=>({...r,[t]:(r[t]||[]).filter(a=>a!==e)})),b(r=>[...r,e]))},q=()=>{var r;let e=0;(c.categories||[]).forEach(a=>{const m=f[a.name]||[],i=a.items;m.length===i.length&&m.every(u=>i.includes(u))&&e++});const t=e===(((r=c.categories)==null?void 0:r.length)||0);R(t?{correct:1}:{incorrect:1}),t?I():W(),N(!0)},B=()=>{const e=[...c.words].sort(()=>Math.random()-.5);b(e);const t={};(c.categories||[]).forEach(r=>{t[r.name]=[]}),w(t),N(!1)},K=()=>{const e=Math.floor((Date.now()-D)/1e3),{sessionScore:t}=A.getState(),r=t.correct>0?100:0,a=t.accuracy;z({score:r,totalQuestions:t.total,correctAnswers:t.correct,moduleId:n.id,learningMode:"sorting",timeSpent:e}),_(n.name,r,a),$(n.id,r,e),v("menu")},S=p.length===0;return s.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:n.name}),s.jsxs("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full",children:[c.words.length-p.length,"/",c.words.length]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:s.jsx("div",{className:"bg-orange-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${c.words.length>0?(c.words.length-p.length)/c.words.length*100:0}%`}})}),s.jsx("p",{className:"instruction-text instruction-text--small instruction-text--center mt-2",children:S?"All words sorted! Check your answers":"Drag and drop words into categories"})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"section-header instruction-text--medium mb-2",children:"Available Words"}),s.jsxs("div",{className:"available-words-area",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((e,t)=>s.jsx("div",{draggable:!0,onDragStart:r=>O(r,e),className:"word-chip",children:e},`available-${t}-${e}`))}),p.length===0&&s.jsx("p",{className:"instruction-text instruction-text--center",children:"All words have been sorted!"})]})]}),s.jsx("div",{className:"grid grid-cols-3 gap-1 sm:gap-4 lg:gap-6 mb-4",children:(c.categories||[]).map(e=>{const t=f[e.name]||[],r=g&&t.length===e.items.length&&t.every(o=>e.items.includes(o)),a=g&&!r,m=M===e.name;let i="drop-zone";return g?r?i+=" drop-zone--correct":a?i+=" drop-zone--error":i+=" drop-zone--neutral":(i+=" drop-zone--interactive",m&&(i+=" drop-zone--drag-over")),s.jsxs("div",{onDragOver:o=>F(o,e.name),onDragLeave:P,onDrop:o=>T(o,e.name),className:i,children:[s.jsxs("h4",{className:"drop-zone__header",children:[e.name,g&&s.jsx("span",{className:`ml-2 ${r?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:r?"✓":"✗"})]}),s.jsx("div",{className:"space-y-2",children:t.map((o,u)=>s.jsx("div",{onClick:()=>U(o,e.name),className:`px-1 py-1 sm:px-3 sm:py-2 rounded text-center cursor-pointer transition-colors text-xs sm:text-sm ${g?e.items.includes(o)?"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200":"bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200":"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-900 dark:text-white"}`,children:o},`${e.name}-${u}-${o}`))}),g&&a&&s.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded text-xs",children:[s.jsx("strong",{className:"help-text--strong",children:"Correct items:"})," ",s.jsx("span",{className:"help-text",children:e.items.join(", ")})]})]},e.name)})}),s.jsxs("div",{className:"flex justify-center items-center gap-3 flex-wrap mt-6",children:[s.jsx(se,{onClick:()=>v("menu"),title:"Return to main menu",children:"Back to Menu"}),s.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),g?s.jsx("button",{onClick:K,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:s.jsx("span",{children:"Finish Exercise"})}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:B,className:"p-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors shadow-sm",title:"Reset Exercise",children:s.jsx(te,{className:"h-4 w-4"})}),s.jsxs("button",{onClick:q,disabled:!S,className:"flex items-center gap-2 px-6 py-2.5 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:[s.jsx(re,{className:"h-4 w-4"}),s.jsx("span",{children:"Check Answers"})]})]})]})]})};export{de as default};
