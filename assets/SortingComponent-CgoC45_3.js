import{r as l,u as E,a as G,d as H,b as J,j as r}from"./index-Tghuj-1g.js";import{u as X}from"./useToast-D7WQYd5T.js";import{u as Y}from"./useLearningCleanup-qXJUIooo.js";import{R as Z}from"./rotate-ccw-D4R_i54w.js";import{C as _}from"./check-D6lIamT3.js";const oe=({module:n})=>{const[f,k]=l.useState(null),[v,x]=l.useState({}),[m,h]=l.useState([]),[i,j]=l.useState(!1),[A]=l.useState(Date.now()),{updateSessionScore:D,setCurrentView:b}=E(),{updateUserScore:M}=G(),{addProgressEntry:$}=H(),{showCorrectAnswer:I,showIncorrectAnswer:R,showModuleCompleted:W}=X();Y();const[d,F]=l.useState({id:"",words:[],categories:[]});l.useEffect(()=>{const e=s=>{s.key==="Escape"&&b("menu")};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b]),l.useEffect(()=>{var s;let e={id:"",words:[],categories:[]};if(n!=null&&n.data&&Array.isArray(n.data)){const t=n.data[0];if(t&&"category"in t&&"word"in t){const o=[...new Set(n.data.map(c=>c.category))].sort(()=>Math.random()-.5),{gameSettings:g}=J.getState(),y=g.sortingMode.wordCount,u=g.sortingMode.categoryCount||3,Q=o.slice(0,u),V=Math.ceil(y/u),N=[],z=Q.map(c=>{const p=(n.data||[]).filter(w=>w.category===c).map(w=>w.word).slice(0,V);return N.push(...p),{name:c.charAt(0).toUpperCase()+c.slice(1),items:p}}),S=N.slice(0,y),B=z.map(c=>({...c,items:c.items.filter(p=>S.includes(p))}));e={id:"sorting-exercise",words:S,categories:B}}}if(F(e),((s=e.words)==null?void 0:s.length)>0){const t=[...e.words].sort(()=>Math.random()-.5);h(t);const a={};(e.categories||[]).forEach(o=>{a[o.name]=[]}),x(a)}},[n.id,n.data]);const P=(e,s)=>{k(s),e.dataTransfer.effectAllowed="move"},T=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},L=(e,s)=>{e.preventDefault(),f&&(h(t=>t.filter(a=>a!==f)),x(t=>({...t,[s]:[...t[s]||[],f]})),k(null))},U=(e,s)=>{i||(x(t=>({...t,[s]:(t[s]||[]).filter(a=>a!==e)})),h(t=>[...t,e]))},q=()=>{var t;let e=0;(d.categories||[]).forEach(a=>{const o=v[a.name]||[],g=a.items;o.length===g.length&&o.every(u=>g.includes(u))&&e++});const s=e===(((t=d.categories)==null?void 0:t.length)||0);D(s?{correct:1}:{incorrect:1}),s?I():R(),j(!0)},O=()=>{const e=[...d.words].sort(()=>Math.random()-.5);h(e);const s={};(d.categories||[]).forEach(t=>{s[t.name]=[]}),x(s),j(!1)},K=()=>{const e=Math.floor((Date.now()-A)/1e3),{sessionScore:s}=E.getState(),t=s.correct>0?100:0,a=s.accuracy;$({score:t,totalQuestions:s.total,correctAnswers:s.correct,moduleId:n.id,learningMode:"sorting",timeSpent:e}),W(n.name,t,a),M(n.id,t,e),b("menu")},C=m.length===0;return r.jsxs("div",{className:"max-w-6xl mx-auto p-3 sm:p-6",children:[r.jsxs("div",{className:"mb-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:n.name}),r.jsxs("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full",children:[d.words.length-m.length,"/",d.words.length]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:r.jsx("div",{className:"bg-orange-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${d.words.length>0?(d.words.length-m.length)/d.words.length*100:0}%`}})}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:C?"All words sorted! Check your answers":"Drag and drop words into categories"})]}),r.jsxs("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Available Words"}),r.jsxs("div",{className:"min-h-[80px] p-4 bg-gray-50 dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg",children:[r.jsx("div",{className:"flex flex-wrap gap-2",children:m.map((e,s)=>r.jsx("div",{draggable:!0,onDragStart:t=>P(t,e),className:"px-2 py-1 sm:px-3 sm:py-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg cursor-move hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors select-none text-xs sm:text-sm",children:e},`available-${s}-${e}`))}),m.length===0&&r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center",children:"All words have been sorted!"})]})]}),r.jsx("div",{className:"grid grid-cols-3 gap-1 sm:gap-4 lg:gap-6 mb-4",children:(d.categories||[]).map(e=>{const s=v[e.name]||[],t=i&&s.length===e.items.length&&s.every(o=>e.items.includes(o)),a=i&&!t;return r.jsxs("div",{onDragOver:T,onDrop:o=>L(o,e.name),className:`p-1 sm:p-4 border-2 border-dashed rounded-lg min-h-[140px] sm:min-h-[200px] ${i?t?"border-green-400 dark:border-green-500 bg-green-50 dark:bg-green-900":a?"border-red-400 dark:border-red-500 bg-red-50 dark:bg-red-900":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800":"border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 hover:border-blue-400 dark:hover:border-blue-500"}`,children:[r.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2 sm:mb-3 text-center text-sm sm:text-base",children:[e.name,i&&r.jsx("span",{className:`ml-2 ${t?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:t?"✓":"✗"})]}),r.jsx("div",{className:"space-y-2",children:s.map((o,g)=>r.jsx("div",{onClick:()=>U(o,e.name),className:`px-1 py-1 sm:px-3 sm:py-2 rounded text-center cursor-pointer transition-colors text-xs sm:text-sm ${i?e.items.includes(o)?"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200":"bg-red-200 dark:bg-red-800 text-red-800 dark:text-red-200":"bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-900 dark:text-white"}`,children:o},`${e.name}-${g}-${o}`))}),i&&a&&r.jsxs("div",{className:"mt-3 p-2 bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded text-xs",children:[r.jsx("strong",{className:"text-yellow-800 dark:text-yellow-200",children:"Correct items:"})," ",r.jsx("span",{className:"text-yellow-700 dark:text-yellow-300",children:e.items.join(", ")})]})]},e.name)})}),r.jsxs("div",{className:"flex justify-center items-center gap-3 flex-wrap mt-6",children:[r.jsx("button",{onClick:()=>b("menu"),className:"flex items-center gap-1 px-4 py-2.5 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg transition-colors text-sm font-medium",children:"← Menu"}),r.jsx("div",{className:"w-px h-6 bg-gray-300 mx-1"}),i?r.jsx("button",{onClick:K,className:"flex items-center gap-2 px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:r.jsx("span",{children:"Finish Exercise"})}):r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:O,className:"p-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors shadow-sm",title:"Reset Exercise",children:r.jsx(Z,{className:"h-4 w-4"})}),r.jsxs("button",{onClick:q,disabled:!C,className:"flex items-center gap-2 px-6 py-2.5 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white rounded-lg transition-colors text-sm font-medium shadow-sm",children:[r.jsx(_,{className:"h-4 w-4"}),r.jsx("span",{children:"Check Answers"})]})]})]})]})};export{oe as default};
