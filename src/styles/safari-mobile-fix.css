/**
 * Safari Mobile Theme Fix - Clean Implementation
 * 
 * Uses design system tokens and BEM-like naming conventions
 * to fix Safari Mobile theme conflicts while maintaining code quality
 */

/* Safari Mobile Detection */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 768px) {
    /* === LIGHT MODE FIXES === */
    /* Override system dark mode when app is in light mode */
    @media (prefers-color-scheme: dark) {
      html:not(.dark),
      html.light {
        color-scheme: light !important;
        -webkit-color-scheme: light !important;
        background-color: var(--header-bg, #ffffff) !important;
        color: var(--header-text-primary, #111827) !important;
      }

      /* Header Component */
      html:not(.dark) .header-redesigned,
      html.light .header-redesigned {
        background-color: var(--header-bg, #ffffff) !important;
        color: var(--header-text-primary, #111827) !important;
        border-color: var(--header-border, #e5e7eb) !important;
      }

      html:not(.dark) .header-redesigned__title,
      html:not(.dark) .header-redesigned__username,
      html.light .header-redesigned__title,
      html.light .header-redesigned__username {
        color: var(--header-text-primary, #111827) !important;
      }

      /* Module Cards */
      html:not(.dark) .module-card,
      html.light .module-card {
        background-color: var(--header-bg, #ffffff) !important;
        color: var(--header-text-primary, #111827) !important;
        border-color: var(--header-border, #e5e7eb) !important;
      }

      html:not(.dark) .module-card__title,
      html:not(.dark) .module-card__description,
      html.light .module-card__title,
      html.light .module-card__description {
        color: var(--header-text-primary, #111827) !important;
      }

      /* Compact Settings Components */
      html:not(.dark) .compact-settings__container,
      html:not(.dark) .compact-settings__header,
      html:not(.dark) .compact-settings__content,
      html:not(.dark) .compact-settings__footer,
      html.light .compact-settings__container,
      html.light .compact-settings__header,
      html.light .compact-settings__content,
      html.light .compact-settings__footer {
        background-color: var(--settings-bg, #ffffff) !important;
        color: var(--settings-text-primary, #111827) !important;
        border-color: var(--settings-border, #e5e7eb) !important;
      }

      html:not(.dark) .compact-settings__title,
      html:not(.dark) .compact-settings__label,
      html:not(.dark) .compact-settings__tab,
      html.light .compact-settings__title,
      html.light .compact-settings__label,
      html.light .compact-settings__tab {
        color: var(--settings-text-primary, #111827) !important;
      }

      /* Form Elements */
      html:not(.dark) .compact-settings__select,
      html:not(.dark) .compact-settings__input,
      html.light .compact-settings__select,
      html.light .compact-settings__input {
        background-color: var(--settings-input-bg, #ffffff) !important;
        color: var(--settings-text-primary, #111827) !important;
        border-color: var(--settings-input-border, #d1d5db) !important;
      }

      /* Learning Components */
      html:not(.dark) .flashcard-component,
      html:not(.dark) .quiz-component,
      html:not(.dark) .sorting-component,
      html:not(.dark) .matching-component,
      html.light .flashcard-component,
      html.light .quiz-component,
      html.light .sorting-component,
      html.light .matching-component {
        background-color: var(--header-bg, #ffffff) !important;
        color: var(--header-text-primary, #111827) !important;
        border-color: var(--header-border, #e5e7eb) !important;
      }

      /* SVG Icons - Using semantic selectors */
      html:not(.dark) .header-redesigned svg,
      html:not(.dark) .module-card svg,
      html:not(.dark) .compact-settings__container svg,
      html:not(.dark) [data-lucide],
      html.light .header-redesigned svg,
      html.light .module-card svg,
      html.light .compact-settings__container svg,
      html.light [data-lucide] {
        color: var(--header-icon-color, #374151) !important;
        stroke: var(--header-icon-color, #374151) !important;
      }

      /* Navigation Elements */
      html:not(.dark) .nav-btn,
      html.light .nav-btn {
        background-color: transparent !important;
        color: var(--header-text-primary, #111827) !important;
      }

      html:not(.dark) .nav-btn:hover,
      html.light .nav-btn:hover {
        background-color: var(--header-button-hover-bg, #f3f4f6) !important;
      }
    }

    /* === DARK MODE CONSISTENCY === */
    /* Ensure dark mode works correctly when system is light */
    @media (prefers-color-scheme: light) {
      html.dark {
        color-scheme: dark !important;
        -webkit-color-scheme: dark !important;
        background-color: var(--gray-800, #1f2937) !important;
        color: var(--gray-50, #ffffff) !important;
      }

      html.dark .header-redesigned,
      html.dark .module-card,
      html.dark .compact-settings__container {
        background-color: var(--gray-800, #1f2937) !important;
        color: var(--gray-50, #ffffff) !important;
        border-color: var(--gray-600, #4b5563) !important;
      }
    }

    /* === WEBKIT SPECIFIC FIXES === */
    /* Additional Safari-specific properties */
    html:not(.dark),
    html.light {
      -webkit-appearance: none !important;
    }

    html.dark {
      -webkit-appearance: none !important;
    }
  }
}

/* === ACCESSIBILITY PRESERVATION === */
/* Ensure high contrast mode still works */
@media (prefers-contrast: high) {
  @supports (-webkit-touch-callout: none) {
    html:not(.dark) {
      background-color: #ffffff !important;
      color: #000000 !important;
    }

    html.dark {
      background-color: #000000 !important;
      color: #ffffff !important;
    }
  }
}

/* === REDUCED MOTION SUPPORT === */
/* Respect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  @supports (-webkit-touch-callout: none) {
    html:not(.dark) *,
    html.light *,
    html.dark * {
      transition: none !important;
      animation: none !important;
    }
  }
}
